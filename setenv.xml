<project name="qtjambi.setenv" default="setenv" basedir=".">

    <!--
        This file will sets various properties necessary for the build process.
        It is called from the main build.xml file.

        NOTE: it needs ant-contrib in your CLASSPATH environment variable.
    -->

    <taskdef resource="net/sf/antcontrib/antlib.xml"/>
    <property file="antcontrib.properties"/>

    <!--
        We want the environment variables and we want a timestamp for jars.
    -->

    <property environment="env"/>

    <tstamp/>

    <!--
        Do we have QTDIR set at all?
    -->

    <target name="check-qtdir">
        <fail message="QTDIR is not set">
            <condition>
                <not>
                    <isset property="env.QTDIR"/>
                </not>
            </condition>
        </fail>
        <property name="qtdir" value="${env.QTDIR}"/>
    </target>

    <!--
        Is qmake there?
    -->

    <target name="lookup-qmake" depends="check-qtdir">
        <var name="qtjambi.qmake" value="${env.QTDIR}/bin/qmake"/>
        <if>
            <os family="windows"/>
            <then>
                <var name="qtjambi.qmake" value="${env.QTDIR}/bin/qmake.exe"/>
            </then>
        </if>
        <fail message="Cannot find qmake! Have you configured Qt yet?">
            <condition>
                <not>
                    <available file="${qtjambi.qmake}" type="file"/>
                </not>
            </condition>
        </fail>
    </target>

    <target name="lookup-libsubdir">
        <var name="libsubdir" value="lib"/>
        <if>
            <os family="windows"/>
            <then>
                <var name="libsubdir" value="bin"/>
            </then>
        </if>
    </target>

    <target name="setenv" depends="lookup-libsubdir, lookup-qmake">
        <property name="qtjambi.libsubdir" value="${libsubdir}"/>
        <property name="qtjambi.qtdir" value="${qtdir}"/>
        <property name="qtjambi.qmake" value="${qtjambi.qmake}"/>
    </target>

</project>
