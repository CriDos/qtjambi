<project name="qtjambi.setenv" default="setenv" basedir=".">

    <!--
        This file will sets various properties necessary for the build process.
        It is called from the main build.xml file.
    -->

    <!--
        We want the environment variables and we want a timestamp for jars.
    -->

    <property environment="env"/>

    <tstamp/>

    <!--
        Do we have QTDIR set at all?
    -->

    <fail message="QTDIR is not set">
        <condition>
            <not>
                <isset property="env.QTDIR"/>
            </not>
        </condition>
    </fail>

    <!--
        Is qmake there?
    -->

    <property name="qmake" value="${env.QTDIR}/bin/qmake"/>

    <fail message="Qt is not configured, cannot find qmake">
        <condition>
            <not>
                <available file="${qmake}" type="file"/>
            </not>
        </condition>
    </fail>

    <!--
        The three following would be sooo much more comfortable with
        ant-contrib's <if>...
    -->

    <condition property="iswindows">
        <os family="windows"/>
    </condition>

    <target name="libsubdir.if.windows" if="iswindows">
        <property name="libsubdir" value="bin"/>
    </target>

    <target name="libsubdir.if.not.windows" unless="iswindows">
        <property name="libsubdir" value="lib"/>
    </target>

    <target name="setenv"
        depends="libsubdir.if.windows, libsubdir.if.not.windows">
        <propertyfile file="env.properties">
            <entry key="qtjambi.libsubdir" value="${libsubdir}"/>
        </propertyfile>
    </target>
</project>

