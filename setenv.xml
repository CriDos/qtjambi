<project name="qtjambi.setenv" default="setenv" basedir=".">

    <!--
        This file will sets various properties necessary for the build process.
        It is called from the main build.xml file.
    -->

    <!--
        We want the environment variables and we want a timestamp for jars.
    -->

    <property environment="env"/>

    <tstamp/>

    <!--
        Are we under Windows?
    -->

    <condition property="iswindows">
        <os family="windows"/>
    </condition>

    <!--
        Do we have QTDIR set at all?
    -->

    <fail message="QTDIR is not set">
        <condition>
            <not>
                <isset property="env.QTDIR"/>
            </not>
        </condition>
    </fail>

    <property name="qtdir" value="${env.QTDIR}"/>

    <!--
        Is qmake there?
    -->

    <target name="qmake.if.windows" if="iswindows">
        <property name="qmake" value="${env.QTDIR}/bin/qmake.exe"/>
    </target>

    <target name="qmake.if.not.windows" unless="iswindows">
        <property name="qmake" value="${env.QTDIR}/bin/qmake"/>
    </target>

    <target name="lookup-qmake"
        depends="qmake.if.windows, qmake.if.not.windows">
        <fail message="Cannot find qmake! Have you configured Qt yet?">
            <condition>
                <not>
                    <available file="${qmake}" type="file"/>
                </not>
            </condition>
        </fail>
    </target>

    <target name="libsubdir.if.windows" if="iswindows">
        <property name="libsubdir" value="bin"/>
    </target>

    <target name="libsubdir.if.not.windows" unless="iswindows">
        <property name="libsubdir" value="lib"/>
    </target>

    <target name="lookup-libsubdir"
        depends="libsubdir.if.windows, libsubdir.if.not.windows"/>

    <target name="setenv" depends="lookup-libsubdir, lookup-qmake">
        <propertyfile file="buildenv.properties">
            <entry key="qtjambi.libsubdir" value="${libsubdir}"/>
            <entry key="qtjambi.qtdir" value="${qtdir}"/>
        </propertyfile>
    </target>
</project>

