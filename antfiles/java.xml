<project name="qtjambi.java">
    <!--
        Pure Java jar targets:

        * ant-qtjambi.jar contains the code for many ant tasks used along the
          file (qmake, make, generator, juic...);
        * qtjambi.jar is the core jar for Qt Jambi applications;
        * qtjambi-designer.jar is the Java equivalent of Qt Designer;
        * qtjambi-examples.jar is a jar containing examples of Qt Jambi in
          action.

        Some of them, like jar.qtjambi, depend on other parts of this build
        file.

        As you will see, each of these targets is preceeded by a fileset. The
        rule is to create a fileset with id "java.src.<modulenamehere>" and to
        call the ant jar.xml file with inheritrefs=true (otherwise it will NOT
        see the defined fileset).

        TODO: refactor. Names are horrible, atleast
    -->

    <target name="jar.ant-qtjambi" depends="jar.qtjambi-util"
        description="Creates a .jar file containing all the Qt Jambi ant tasks.">
        <ant antfile="antfiles/jar.xml" inheritrefs="true">
            <property name="module" value="ant-qtjambi"/>
            <property name="destdir" value="${jardir}/nobundle"/>
            <property name="sourcedirs" value="${java.srcdir}/ant-qtjambi"/>
        </ant>
    </target>

    <target name="jar.qtjambi-util">
        <ant antfile="antfiles/jar.xml" inheritrefs="true">
            <property name="module" value="qtjambi-util"/>
            <property name="sourcedirs" value="${java.srcdir}/qtjambi-util"/>
        </ant>
    </target>

    <target name="jar.qtjambi"
        depends="init, jar.qtjambi-util">
        <!-- 1. This is a fix for adding the OsInfo class to the the main jar-->
        <!--
            2. Copy version.properties to generated dir for packaging.
            TODO: version.properties shouldnâ€™t be copied in first place.
        -->
        <echo message="${java.outdir}"/>
        <copy todir="${java.outdir}/qtjambi">
            <fileset dir="${java.outdir}/qtjambi-util">
                <include name="**/*"/>
            </fileset>
            <fileset dir=".">
                <include name="version.properties" />
            </fileset>
        </copy>
        <ant antfile="antfiles/jar.xml" inheritrefs="true">
            <property name="module" value="qtjambi"/>
            <property name="sourcedirs" value="${java.srcdir}/qtjambi:${generator.outputdir}/java"/>
        </ant>
    </target>

    <target name="jar.qtjambi-designer"
        depends="init, jar.qtjambi">
        <ant antfile="antfiles/jar.xml" inheritrefs="true">
            <property name="module" value="qtjambi-designer"/>
            <property name="sourcedirs" value="${java.srcdir}/qtjambi-designer"/>
        </ant>
    </target>

    <fileset id="java.src.qtjambi-examples"
        dir="${java.srcdir}/qtjambi-examples">
        <include name="**/*.java"/>
        <exclude name="src/java/qtjambi-examples/com/trolltech/demos/phonon/*.java"
            unless="qtjambi.phonon"/>
        <exclude name="com/trolltech/examples/phonon/*.java"
            unless="qtjambi.phonon"/>
        <exclude name="src/java/qtjambi-examples/com/trolltech/demos/xmlpatterns/*.java"
            unless="qtjambi.xmlpatterns"/>
        <exclude name="src/java/qtjambi-examples/com/trolltech/examples/xmlpatterns/*.java"
            unless="qtjambi.xmlpatterns"/>
        <exclude name="src/java/qtjambi-examples/com/trolltech/demos/webkit/*.java"
            unless="qtjambi.webkit"/>
        <exclude name="src/java/qtjambi-examples/com/trolltech/examples/webkit/*.java"
            unless="qtjambi.webkit"/>
        <exclude name="src/java/qtjambi-examples/com/trolltech/examples/opengl/*.java"
            unless="qtjambi.opengl"/>
        <exclude name="src/java/qtjambi-examples/com/trolltech/demos/opengl/*.java"
            unless="qtjambi.opengl"/>
    </fileset>

    <target name="jar.qtjambi-examples.juic" depends="tools.juic.make">
        <dojuic module="qtjambi-examples"/>
    </target>

    <target name="jar.qtjambi-examples"
        depends="jar.qtjambi-designer, jar.qtjambi-examples.juic">
        <ant antfile="antfiles/jar.xml" inheritrefs="true">
            <property name="module" value="qtjambi-examples"/>
            <property name="sourcedirs" value="${java.srcdir}/qtjambi-examples:${java.generated.srcdir}/qtjambi-examples"/>
        </ant>
    </target>
</project>