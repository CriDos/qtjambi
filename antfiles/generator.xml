<project name="qtjambi.generator">
    <!--
        Building and running the Generator
    -->

    <target name="generator.run" depends="init, generator.xmlmerge"
        description="Runs the Qt Jambi generator on the Qt headers">
        <mkdir dir="${generator.outputdir}"/>
        <generator dir="${generatorDir}"
                outputDirectory="${generator.outputdir}"
                typesystem="${generatorDir}/targets/build_all.xml"
                header="${generatorDir}/targets/qtjambi_masterinclude.h"
                phononpath="${qtjambi.phonon.includedir}"
                qtincludedirectory="${qtjambi.qt.includedir}"
                options="${qtjambi.generator.jumptable}"/>
    </target>

    <target name="tools.generator.qmake" depends="init">
        <qmake dir="generator" pro="generator/generator.pro"
                config="${qtjambi.configuration}"
                qmakebinary="${qmake.binary}"/>
    </target>

    <target name="tools.generator.make" depends="tools.generator.qmake">
        <make dir="generator"/>
    </target>

    <!--
        XML Merging for the generator
    -->

    <macrodef name="xmlmerge">
        <attribute name="victim"/>
        <sequential>
            <xslt force="true" style="${generator.xmlmerge.srcdir}/merge.xsl"
                in="${generator.xmlmerge.srcdir}/typesystem_@{victim}-common.xml"
                out="${generator.xmlmerge.outputdir}/typesystem_@{victim}.xml">
                <param name="source"
                    expression="typesystem_@{victim}-java.xml"/>
            </xslt>
        </sequential>
    </macrodef>

    <target name="generator.xmlmerge"
        description="Merges the XML files used by the Qt Jambi generator.">
        <xmlmerge victim="core"/>
        <xmlmerge victim="gui"/>
        <xmlmerge victim="xml"/>
        <xmlmerge victim="network"/>
        <xmlmerge victim="opengl"/>
        <xmlmerge victim="sql"/>
        <xmlmerge victim="svg"/>
        <xmlmerge victim="help"/>
        <xmlmerge victim="multimedia"/>
        <xmlmerge victim="webkit"/>
        <xmlmerge victim="phonon"/>
        <xmlmerge victim="xmlpatterns"/>
        <xmlmerge victim="designer"/>
        <xmlmerge victim="script"/>
        <xmlmerge victim="scripttools"/>
    </target>

</project>