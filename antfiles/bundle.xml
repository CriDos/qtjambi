<project name="qtjambi.bundle" default="library.native.bundle">

    <!--
        ************************************************************
        Library Compilation etc ...
        ************************************************************
    -->

    <!-- 
        Runs qmake for Jambi source
    -->
    <target name="library.native.qmake" depends="init"
        description="Runs qmake on the Qt Jambi native library">
        <qmake recursive="true" dir="${outputDir}"
            pro="java.pro"
            config="${qtjambi.configuration} ${qtjambi.config.jumptable}"
            qtconfig="${qtjambi.qtconfig}"
            debugTools="${qtjambi.debug-tools}"
            qmakebinary="${qmake.binary}"/>
    </target>

    <!--
        Runs make for Jambi source
    -->
    <target name="library.native.compile" depends="library.native.qmake"
        description="Compiles the C++ Qt Jambi library">
        <make dir="${outputDir}"/>
    </target>

    <target name="library.native.bundle" depends="library.native.compile"
            description="Creates a .jar file file containing native libraries.">

        <qtjambi-platform-jar cacheKey="${qtjambi.compiler}-${DSTAMP}-${TSTAMP}"
                              outdir="${outputDir}/platform-output">

            <!-- Qt Libraries -->
            <library name="QtCore"              type="qt"
                    rootPath="${qtjambi.qt.libdir}"/>
            <library name="QtGui"               type="qt"
                    rootPath="${qtjambi.qt.libdir}"/>
            <library name="QtXml"               type="qt"
                    rootPath="${qtjambi.qt.libdir}"/>
            <library name="QtSql"               type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.sql}"/>
            <library name="QtSvg"               type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    load="yes"
                    if="${qtjambi.svg}"/>
            <library name="QtNetwork"           type="qt"
                    rootPath="${qtjambi.qt.libdir}"/>
            <library name="QtHelp"              type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.help}"/>
            <library name="QtScript"            type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.script}"/>
            <library name="QtScriptTools"       type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.scripttools}"/>
            <library name="QtMultimedia"        type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.multimedia}"/>
            <library name="QtOpenGL"            type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.opengl}"/>
            <library name="QtWebKit"            type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.webkit}"/>
            <library name="QtXmlPatterns"       type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.xmlpatterns}"/>
            <library name="QtDeclarative"       type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.declarative}"/>
            <library name="QtDBus"              type="qt"
                    rootPath="${qtjambi.qt.libdir}"
                    if="${qtjambi.dbus}"/>

            <library name="phonon"              type="qt"
                    rootPath="${qtjambi.phonon.libdir}"
                    if="${qtjambi.phonon}"/>
            <library name="phonon_ds9"          type="plugin"
                    rootPath="${qtjambi.phonon.pluginsdir}"
                    subdir="plugins/phonon_backend"
                    load="never"
                    if="${qtjambi.phonon_ds9}"/>
            <library name="phonon_gstreamer"    type="plugin"
                    rootPath="${qtjambi.phonon.pluginsdir}"
                    subdir="plugins/phonon_backend"
                    load="never"
                    kdephonon="${qtjambi.phonon.kdephonon}"
                    if="${qtjambi.phonon_gstreamer}"/>
            <library name="phonon_qt7"          type="plugin"
                    rootPath="${qtjambi.phonon.pluginsdir}"
                    subdir="plugins/phonon_backend"
                    load="never"
                    if="${qtjambi.phonon_qt7}"/>

            <!-- Qt Plugins -->
            <library name="qtaccessiblewidgets" type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/accessible" load="never"
                    if="${qtjambi.plugins.accessible.qtaccessiblewidgets}"/>

            <library name="qsvgicon"            type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/iconengines" load="never"
                    if="${qtjambi.plugins.iconengines.svgicon}"/>

            <library name="qgif"                type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/imageformats" load="never"
                    if="${qtjambi.plugins.imageformats.gif}"/>
            <library name="qico"                type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/imageformats" load="never"
                    if="${qtjambi.plugins.imageformats.ico}"/>
            <library name="qjpeg"               type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/imageformats" load="never"
                    if="${qtjambi.plugins.imageformats.jpeg}"/>
            <library name="qmng"                type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/imageformats" load="never"
                    if="${qtjambi.plugins.imageformats.mng}"/>
            <library name="qpng"               type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/imageformats" load="never"
                    if="${qtjambi.plugins.imageformats.png}"/>
            <library name="qsvg"                type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/imageformats" load="never"
                    if="${qtjambi.plugins.imageformats.svg}"/>
            <library name="qtiff"               type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/imageformats" load="never"
                    if="${qtjambi.plugins.imageformats.tiff}"/>

            <!-- Unicode codecs -->
            <library name="qcncodecs"           type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/codecs" load="never"
                    if="${qtjambi.plugins.codecs.cncodecs}"/>
            <library name="qjpcodecs"           type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/codecs" load="never"
                    if="${qtjambi.plugins.codecs.jpcodecs}"/>
            <library name="qkrcodecs"           type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/codecs" load="never"
                    if="${qtjambi.plugins.codecs.krcodecs}"/>
            <library name="qtwcodecs"           type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/codecs" load="never"
                    if="${qtjambi.plugins.codecs.twcodecs}"/>

            <library name="qsqlite" type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/sqldrivers"
                    load="never"
                    if="${qtjambi.plugins.sqldrivers.sqlite}"/>
            <library name="qodbc" type="plugin"
                    rootPath="${qtjambi.qt.pluginsdir}"
                    subdir="plugins/sqldrivers"
                    load="never"
                    if="${qtjambi.plugins.sqldrivers.odbc}"/>

            <!-- Qt Jambi Libraries -->
            <library name="qtjambi"                  type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"/>
            <library name="com_trolltech_qt_core"    type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"/>
            <library name="com_trolltech_qt_gui"     type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"/>
            <library name="com_trolltech_qt_xml"     type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"/>
            <library name="com_trolltech_qt_sql"     type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.sql}"/>
            <library name="com_trolltech_qt_help"    type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.help}"/>
            <library name="com_trolltech_qt_script"  type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.script}"/>
            <library name="com_trolltech_qt_scripttools"    type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.scripttools}"/>
            <library name="com_trolltech_qt_multimedia"     type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.multimedia}"/>
            <library name="com_trolltech_qt_svg"     type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.svg}"/>
            <library name="com_trolltech_qt_opengl"  type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.opengl}"/>
            <library name="com_trolltech_qt_network" type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"/>
            <library name="com_trolltech_qt_phonon"  type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.phonon}"/>
            <library name="com_trolltech_qt_webkit"  type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.webkit}"/>
            <library name="com_trolltech_qt_xmlpatterns"  type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.xmlpatterns}"/>
            <library name="com_trolltech_qt_declarative"  type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.declarative}"/>
            <library name="com_trolltech_qt_dbus"    type="qtjambi"
                    rootPath="${qtjambi.jambi.libdir}"
                    if="${qtjambi.dbus}"/>

            <!-- Win32/Win64 zlib1.dll -->
            <library name="zlib1"           type="dso"
                    rootPath="${qtjambi.qt.libdir}"
                    load="never"
                    if="${qtjambi.packaging.dso.zlib1}"/>

            <!-- Win32/Win64 libssl32.dll MinGW only -->
            <library name="libssl32"        type="dso"
                    rootPath="${qtjambi.qt.libdir}"
                    load="never"
                    if="${qtjambi.packaging.dso.libssl32}"/>
            <!-- Win32/Win64 ssleay32.dll MSVC only -->
            <library name="ssleay32"        type="dso"
                    rootPath="${qtjambi.qt.libdir}"
                    load="never"
                    if="${qtjambi.packaging.dso.ssleay32}"/>

            <!-- Win32/Win64 libeay32.dll -->
            <library name="libeay32"        type="dso"
                    rootPath="${qtjambi.qt.libdir}"
                    load="never"
                    if="${qtjambi.packaging.dso.libeay32}"/>

        <plugin path="plugins"/>

        </qtjambi-platform-jar>

        <property name="destination-file" value="${outputDir}/qtjambi-${qtjambi.osname}-${qtjambi.compiler}-${qtjambi.version}.jar"/>
        <jar destfile="${destination-file}">
            <fileset dir="${outputDir}/platform-output"/>
            <manifest>
                <attribute name="Built-By" value="${user.name} - ${TODAY}"/>
            </manifest>
        </jar>
        <copy file="${destination-file}" tofile="${jardir}/qtjambi-native.jar"/>

    </target>
</project>
