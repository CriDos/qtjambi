<project default="qtjambi" basedir=".">

    <taskdef name="juic"      classpath="." classname="com.trolltech.tools.ant.JuicTask"/>
    <taskdef name="qmake"     classpath="." classname="com.trolltech.tools.ant.QMakeTask"/>
    <taskdef name="make"      classpath="." classname="com.trolltech.tools.ant.MakeTask"/>
    <taskdef name="generator" classpath="." classname="com.trolltech.tools.ant.GeneratorTask"/>

    <property environment="env"/> 

    <tstamp/>

    <property name="sourceDir" value="." />
    <property name="outputDir" value="classes" />

    <property name="jambiLib" value="./lib" />
    <property name="qt"       value="${env.QTDIR}" />
    <property name="qtLib"    value="${qt}/lib" />
    <property name="config"    value="debug" />

    <target name="clean">
        <delete dir="${outputDir}" />
    </target>

    <target name="prepare" depends="clean">
        <mkdir dir="${outputDir}" />
        <mkdir dir="${outputDir}/com/trolltech/autotests" />
    </target>

    <target name="qmake.qtjambi">
        <delete dir="${jambiLib}" />
	<qmake recursive="true" config="${config} sanitycheck"/>
    </target>

    <target name="qmake.generator">
	<qmake config="release"/>
    </target>

    <target name="compile.generator" depends="qmake.generator">
        <make dir="generator" target="clean" />
        <make dir="generator" />
    </target>

    <target name="generator.qtjambi" >
        <generator dir="generator" />
    </target>

    <target name="generator.example" >
        <generator dir="generator_example"
	           header="global.h"
                   typesystem="typesystem_generatorexample.txt" />
	<make dir="generator_example" target="clean" />
        <qmake recursive="true" config="${config}" dir="generator_example" />
	<make dir="generator_example" />
    </target>

    <target name="compile.qtjambi" >
	<make />
    </target>

    <target name="juic">
        <juic message="Running Juic for all it is worth"
	      outputDir="${sourceDir}"
	      xmlConfigFile=""
              trFunction=""
              classNamePrefix=""
              alwaysUpdate="true"
	      classpath="." >
	     <include name="com/**/**.jui"/>
        </juic>
    </target>

    <target name="compile.java" depends="juic">
        <javac srcdir="${sourceDir}" destdir="${outputDir}">
            <include name="com/**/**.java"/>
            <exclude name="com/trolltech/tools/generator/**/**.java"/>
            <exclude name="com/trolltech/demos/HelloGL.java" />
	    <exclude name="com/trolltech/extensions/**/**.java" />
        </javac>
    </target>

    <target name="deploy.jar" description="JARs the Task">
        <jar destfile="qtjambi.jar">
            <manifest>
                <attribute name="Built-By" value="${USER} - ${TODAY}"/>
                <attribute name="Main-Class" value="com.trolltech.launcher.Launcher"/>
            </manifest>
            <fileset dir="${outputDir}" />
            <fileset dir="${sourceDir}">
                <include name="com/trolltech/**/*.png" />
                <include name="com/trolltech/**/*.html" />
                <include name="com/trolltech/**/*.svg" />
		<include name="com/trolltech/**/*.qm" />
                <include name="com/trolltech/examples/ResourceSystem.jar" />
            </fileset>
        </jar>
    </target>

    <target name="qtjambi" depends="qmake.generator, compile.generator, generator.qtjambi, qmake.qtjambi, compile.qtjambi, compile.java, deploy.jar" />

</project>
