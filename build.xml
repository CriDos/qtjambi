<project default="qtjambi" basedir=".">

    <property environment="env"/> 

    <tstamp/>

    <property name="sourceDir" value="." />

    <property name="jambiLib" value="./lib" />
    <property name="qt"       value="${env.QTDIR}" />
    <property name="qtLib"    value="${qt}/lib" />
    <property name="config"    value="debug" />

    <taskdef name="juic"      classpath="${outputDir}:ant-qtjambi.jar" classname="com.trolltech.tools.ant.JuicTask"/>
    <taskdef name="qmake"     classpath="${outputDir}:ant-qtjambi.jar" classname="com.trolltech.tools.ant.QMakeTask"/>
    <taskdef name="make"      classpath="${outputDir}:ant-qtjambi.jar" classname="com.trolltech.tools.ant.MakeTask"/>
    <taskdef name="generator" classpath="${outputDir}:ant-qtjambi.jar" classname="com.trolltech.tools.ant.GeneratorTask"/>

    <target name="help"
            description="Provide detailed help">
        <echo>To get a description of all tasks, run: ant -projecthelp</echo>
	<echo/>
	<echo>To compile everything, just run ant</echo>
    </target>

    <target name="clean"
            description="Clean everything.">
	<delete file="qtjambi.jar" failonerror="false"/>
	<delete file="qtjambi-launcher.jar" failonerror="false"/>
	<delete file="qtjambi-examples.jar" failonerror="false"/>
	<delete file="qtjambi-designer.jar" failonerror="false"/>
        <delete dir="bin" failonerror="false"/>
	<delete dir="lib" failonerror="false"/>
    </target>

    <target name="qmake.qtjambi"
            description="Run qmake on the Qt Jambi project.">
        <delete dir="${jambiLib}" />
	<qmake recursive="true" config="${config} sanitycheck"/>
    </target>

    <target name="qmake.generator"
            description="Run qmake on the generator.">
	<qmake config="release" dir="generator"/>
    </target>

    <target name="compile.generator" depends="qmake.generator"
            description="Compile the Qt Jambi generator.">
        <make dir="generator" target="clean" />
        <make dir="generator" />
    </target>

    <target name="generator.qtjambi" 
            description="Run the Qt Jambi generator on the Qt source. It will use the Qt version found at the QTDIR variable.">
        <generator dir="generator" outputDirectory=""/>
    </target>

    <target name="generator.generator-example" 
            description="Run the generator on the generator example, qmake it, and compile it.">
        <generator dir="generator_example"
	           header="global.h"
                   typesystem="typesystem_generatorexample.txt" />
        <qmake recursive="true" config="${config}" dir="generator_example" />

    </target>

    <target name="compile.qtjambi" 
            description="Compile the c++ QT Jambi bindings">
	<make />
    </target>

    <target name="juic"
            description="Generates Java source files out of JUI files, created by designer.">
        <juic message="Running Juic for all it is worth"
	      outputDir="${sourceDir}"
	      xmlConfigFile=""
              trFunction=""
              classNamePrefix=""
              alwaysUpdate="true"
	      classpath=".">
	     <include name="com/**/**.jui"/>
        </juic>
    </target>

    <target name="qtjambi.jar">
        <javac srcdir="."
               memoryMaximumSize="1024m"
               fork="true">
            <include name="com/trolltech/qt/*.java"/>
            <include name="com/trolltech/qt/*/*.java"/>
        </javac>

        <jar destfile="qtjambi.jar"
             basedir="."
             includes="com/trolltech/qt/*.class,com/trolltech/qt/*/*.class"
             includesfile="com/trolltech/images/qt-logo.png">
            <manifest>
                <attribute name="Built-By" value="${USER} - ${TODAY}"/>
            </manifest>
        </jar>
    </target>

    <target name="qtjambi-examples.jar">
        <javac srcdir=".">
            <include name="com/trolltech/demos/*.java"/>
            <include name="com/trolltech/examples/*.java"/>
            <exclude name="com/trolltech/examples/GeneratorExample.java"/>
            <exclude name="com/trolltech/demos/HelloGL.java"/>
        </javac>

        <jar destfile="qtjambi-examples.jar"
             basedir=".">
            <include name="com/trolltech/examples/*"/>
            <include name="com/trolltech/demos/*"/> 
            <exclude name="com/trolltech/examples/*.java"/>
            <exclude name="com/trolltech/demos/*.java"/>
           <manifest>
                <attribute name="Built-By" value="${USER} - ${TODAY}"/>
            </manifest>
        </jar>
    </target>

    <target name="qtjambi-launcher.jar">
        <javac srcdir=".">
            <include name="com/trolltech/launcher/*.java"/>
        </javac>

        <jar destfile="qtjambi-launcher.jar"
             basedir=".">
            <include name="com/trolltech/launcher/*"/> 
            <exclude name="com/trolltech/launcher/*.java"/>
           <manifest>
                <attribute name="Built-By" value="${USER} - ${TODAY}"/>
            </manifest>
        </jar>
    </target>

    <target name="qtjambi-designer.jar">
        <javac srcdir=".">
            <include name="com/trolltech/tools/designer/*.java"/>
        </javac>

        <jar destfile="qtjambi-designer.jar"
             basedir=".">
            <include name="com/trolltech/tools/designer/*"/> 
            <exclude name="com/trolltech/tools/designer/*.java"/>
           <manifest>
                <attribute name="Built-By" value="${USER} - ${TODAY}"/>
            </manifest>
        </jar>
    </target>

   

    

    <target name="compile.java" depends="juic"
            description="Compile the Qt Jambi's core java files.">
        <mkdir dir="${outputDir}" />
        <javac srcdir="${sourceDir}" 
               destdir="${outputDir}"
               memoryMaximumSize="1024m"
               fork="true">
            <include name="com/**/**.java"/>
            <exclude name="com/trolltech/tools/generator/**/**.java"/>
            <exclude name="com/trolltech/demos/HelloGL.java" />
	    <exclude name="com/trolltech/extensions/**/**.java" />
	    <exclude name="com/trolltech/autotests/**/**.java" />
	    <exclude name="com/trolltech/manualtests/**/**.java" />
	    <exclude name="com/trolltech/tests/**/**.java" />
            <exclude name="com/trolltech/examples/GeneratorExample.java" />
        </javac>
    </target>
    
    <target name="compile.generator-example"
            description="Compile Qt Jambi generator-example.">
	<make dir="generator_example" />
        <javac srcdir="${sourceDir}" destdir="${outputDir}" >
            <include name="com/trolltech/examples/GeneratorExample.java" />
        </javac>
    </target>

    <target name="generator-example"
            description="Generate code for generator-example, and compile it."
            depends="generator.generator-example, compile.generator-example" />

    <target name="qtjambi"
            description="Make QT Jambi."
            depends="qmake.generator, compile.generator, generator.qtjambi, qmake.qtjambi, compile.qtjambi, qtjambi.jar, qtjambi-examples.jar, qtjambi-launcher.jar, qtjambi-designer.jar" />

</project>
